seed: 42
device: auto
precision: fp16
repro:
  deterministic: false

paths:
  images: f:/Datasets
  train_images: f:/Datasets
  train_masks: data/masks
  train_annotations: data/unified/unified_train.json
  val_images: f:/Datasets
  val_masks: data/masks
  val_annotations: data/unified/unified_val.json
  pseudotargets: data/pseudotargets
  outputs: F:\Datasets\anony-project\outputs\e2e_full

categories:
  - {id: 1, name: face}
  - {id: 2, name: license_plate}

model:
  backbone:
    enabled: true
    hf_model_id: hustvl/yolos-tiny
  detector:
    name: yolos
    pretrained: true
    hf_model_id: hustvl/yolos-tiny
    conf_threshold: 0.5
    nms_iou: 0.5
    target_class_names: [face, person]
  generator:
    backend: diffusers  # cloud-recommended; local fallback: unet
    in_channels: 4
    base_channels: 64
    use_skip: true
    diffusers:
      model_id: stabilityai/stable-diffusion-2-inpainting
      torch_compile: false
      enable_xformers: false
      enable_lora: true
      steps: 20
      guidance_scale: 7.5
      mask_dilate: 2  # planA: small dilation (px) to reduce leakage edge artifacts
    finetune:
      use_lora: true
      learnable_layers: ['unet.up_blocks[-1]']
    torch_compile: false
  discriminator:
    enabled: true
    base_channels: 64
    spectral_norm: true
    torch_compile: false

loss:
  l1_weight: 1.0
  perceptual_weight: 0.1
  id_suppress_weight: 0.2  # enable identity suppression per requirement
  adv_weight: 0.1

train:
  epochs: 24
  batch_size: 2
  num_workers: 2
  grad_accum_steps: 1
  max_steps: null
  optimizer: adamw
  lr: {detector: 1.0e-05, generator: 2.0e-04, discriminator: 2.0e-04}
  alternating: {det_steps: 1, gen_steps: 1, disc_steps: 1}
  pretrain: {enabled: true, steps: 2000}

checkpoint:
  save_every_steps: 2000
  keep_last_k: 3
  resume: null

eval:
  run_on_val_every_steps: 0
  max_images: 50
  metrics: {arcface: true, easyocr: true, fid: true, map: true}
  face_only: false
  categories:
    - {id: 1, name: face}
    - {id: 2, name: license_plate}

inference:
  output_dir: outputs/anonymized_e2e
  save_masks: true
  save_overlays: true

data:
  image_size: 512
  normalize: true
